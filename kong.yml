_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:9000/api
    routes:
      - name: auth-routes
        paths:
          - /api/auth
        strip_path: true
        plugins:
          - name: correlation-id
            config:
              header_name: X-Correlation-ID
              generator: uuid
              echo_downstream: true

          - name: rate-limiting
            config:
              policy: local
              limit_by: ip
              minute: 60
              hour: 500
              fault_tolerant: true
              hide_client_headers: false

          - name: opaque-jwt
            config:
              redis_host: redis
              redis_port: 6379
              redis_database: 0
              redis_timeout_ms: 2000
              key_prefix: "opaque:token:"
              fail_open: false
